var g=Object.defineProperty;var p=(c,l,m)=>l in c?g(c,l,{enumerable:!0,configurable:!0,writable:!0,value:m}):c[l]=m;var i=(c,l,m)=>(p(c,typeof l!="symbol"?l+"":l,m),m);import{d as w,b as f,o as B,c as y,a as E}from"./index-d8xkP207.js";const T={class:"game"},M=E("table",{class:"gameArea",tabindex:"0",style:{outline:"none"}},null,-1),A=[M],L=w({__name:"Game2048",setup(c){class l{generateRandomEvenNumber(){return 2}getRandomIndex(t=1,s){let e=[];for(;t;){let o=Math.floor(Math.random()*s);e.includes(o)||(e.push(o),t--)}return e}test(){}}class m{constructor(){i(this,"width",5);i(this,"height",5);i(this,"speed",300)}}class b{constructor(){i(this,"utilModel");this.utilModel=new l}initBoxesData(t,s){var e=[];for(let o=0;o<s;o++){e[o]=[];for(let r=0;r<t;r++)e[o][r]=new d(o,r,0,1)}return e}getEmptyBoxesData(t){var s=[];for(let e=0;e<t.length;e++)for(let o=0;o<t[e].length;o++)t[e][o].number==0&&s.push({row:e,col:o});return s}getRandomEmptyBox(t,s){let e=[];var o=this.utilModel.getRandomIndex(t,s.length-1);for(let r of o)e.push(s[r]);return e}mergeBoxValueToMaxIndex(t,s=""){console.log("合并前:",_.cloneDeep(t));var e=t.length-1,o=e;let r=[],a,n;for(;e>=0;){if(t[e].number==0){e--;continue}if(t[e].number==t[o].number&&e!==o&&(a=t[o],n=t[e],t[o].number=t[e].number*2,t[e].number=0,r.push({from:n,to:a}),o--),t[e].number!==t[o].number)if(t[o].number==0){t[o].number=t[e].number,t[e].number=0;var x=t[e],v=t[o];r.push({from:x,to:v})}else o--,e!==o&&(t[o].number=t[e].number,t[e].number=0,n=t[e],a=t[o],r.push({from:n,to:a}));e--}return console.log("合并后:",_.cloneDeep(t)),r}mergeBoxValueToMinIndex(t){t.reverse();let s=this.mergeBoxValueToMaxIndex(t,"reverse");return t.reverse(),s}}class d{constructor(t,s,e,o){i(this,"row");i(this,"col");i(this,"number");i(this,"empty");this.row=t,this.col=s,this.number=e,this.empty=o||0}}class u{constructor(t){i(this,"width");i(this,"height");i(this,"speed");i(this,"BoxTool");i(this,"boxesData");i(this,"emptyBoxesData");i(this,"utilModel");i(this,"tableDom");i(this,"tdDoms");this.width=t.width,this.height=t.height,this.speed=t.speed,this.BoxTool=new b,this.boxesData=this.BoxTool.initBoxesData(this.width,this.height),this.utilModel=new l,this.emptyBoxesData=[],this.tdDoms=document.getElementsByTagName("td"),this.tableDom=document.getElementsByClassName("gameArea")[0]}resetEmptyBoxesData(){this.emptyBoxesData=this.BoxTool.getEmptyBoxesData(this.boxesData)}drow(){for(let t=0;t<this.height;t++){let s=document.createElement("tr");for(let e=0;e<this.width;e++){let o=document.createElement("td");if(!o){console.error("tdDom is null");return}s.appendChild(o),o.setAttribute("idx",t+"-"+e)}this.tableDom.appendChild(s)}}initData(){this.emptyBoxesData=this.BoxTool.getEmptyBoxesData(this.boxesData);var[t,s]=this.BoxTool.getRandomEmptyBox(2,this.emptyBoxesData);this.boxesData[t.row][t.col].number=this.utilModel.generateRandomEvenNumber(),this.boxesData[t.row][t.col].empty=0,this.boxesData[s.row][s.row].number=this.utilModel.generateRandomEvenNumber(),this.boxesData[s.row][s.col].empty=0,this.resetEmptyBoxesData();for(let e=0;e<this.boxesData.length;e++)for(let o=0;o<this.boxesData[e].length;o++)this.boxesData[e][o].number>0?(this.tdDoms[e*this.width+o].classList.add("active","c"+this.boxesData[e][o].number),this.tdDoms[e*this.width+o].innerText=this.boxesData[e][o].number):(this.tdDoms[e*this.width+o].classList.remove("active"),this.tdDoms[e*this.width+o].innerText="")}moveCssProcess(t){console.log("移动轨迹:",t);for(var s=0;s<t.length;s++){var e=t[s].from.row+"-"+t[s].from.col,o=document.querySelectorAll('[idx="'+e+'"]')[0];o.classList.remove(...o.classList),o.textContent="";var r=t[s].to.row+"-"+t[s].to.col;let a=document.querySelectorAll('[idx="'+r+'"]')[0];a.classList.add("active","c"+t[s].to.number),a.textContent=t[s].to.number,a.classList.add("shake"),a.addEventListener("transitionend",function(n){let x=n;x.target===a&&x.propertyName==="transform"&&a.classList.remove("shake")}),console.log(o,a)}}move(t=""){if(t=="up")for(var s=0;s<this.width;s++){let o=this.boxesData.map(a=>a[s]),r=this.BoxTool.mergeBoxValueToMinIndex(o);for(var e=0;e<this.height;e++)this.boxesData[e][s]=o[e];this.moveCssProcess(r)}if(t=="down"){console.log("向下:",_.cloneDeep(this.boxesData));for(let o=0;o<this.width;o++){console.log("合并第:",o,"列");let r=this.boxesData.map(n=>n[o]),a=this.BoxTool.mergeBoxValueToMaxIndex(r);for(let n=0;n<this.height;n++)this.boxesData[n][o]=r[n];this.moveCssProcess(a)}console.log("向下:",this.boxesData)}if(t=="left"){console.log(_.cloneDeep(this.boxesData));for(let o=0;o<this.height;o++){let r=this.BoxTool.mergeBoxValueToMinIndex(this.boxesData[o]);this.moveCssProcess(r)}console.log(this.boxesData)}if(t=="right"){console.log(_.cloneDeep(this.boxesData));for(let o=0;o<this.height;o++){let r=this.BoxTool.mergeBoxValueToMaxIndex(this.boxesData[o]);this.moveCssProcess(r)}console.log(this.boxesData)}}activeBox(t=1){var s=this.BoxTool.getRandomEmptyBox(t,this.emptyBoxesData);for(let e of s)this.boxesData[e.row][e.col].number=this.utilModel.generateRandomEvenNumber(),this.boxesData[e.row][e.col].empty=0,this.tdDoms[e.row*this.width+e.col].classList.add("active","c"+this.boxesData[e.row][e.col].number),this.tdDoms[e.row*this.width+e.col].innerText=this.boxesData[e.row][e.col].number;this.resetEmptyBoxesData()}}class D{constructor(t){i(this,"config");i(this,"board");this.config=t,this.board=new u(t)}start(){console.log("start"),this.board.drow(),this.board.initData(),this.binderEvent()}isInsideControlArea(t){const s=document.getElementById("controlArea");return s&&s.contains(t)}binderEvent(){document.getElementsByClassName("gameArea")[0].addEventListener("keydown",s=>{let e=this;var o=s;switch(o.preventDefault(),o.key){case"ArrowLeft":console.log("left"),e.board.move("left"),e.board.activeBox(1);break;case"ArrowUp":e.board.move("up"),e.board.activeBox(1);break;case"ArrowRight":e.board.move("right"),e.board.activeBox(1);break;case"ArrowDown":o.stopPropagation(),o.preventDefault(),e.board.move("down"),e.board.activeBox(1);break}}),this.board.tableDom.addEventListener("keydown",function(s){return function(e){switch(e.key){case"ArrowLeft":s.board.move("left"),s.board.activeBox(1);break;case"ArrowUp":s.board.move("up"),s.board.activeBox(1);break;case"ArrowRight":s.board.move("right"),s.board.activeBox(1);break;case"ArrowDown":s.board.move("down"),s.board.activeBox(1);break}}}(this))}}return f(()=>{var h=new m,t=new D(h);t.start()}),(h,t)=>(B(),y("div",T,A))}});export{L as default};
